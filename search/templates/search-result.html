{% extends 'base.html' %}

{% block title %}Search Results - NarraPro{% endblock %}

{% block extra_head %}
<style>
    /* Hover effect for More buttons */
    .btn-outline-brand {
        border: 1px solid #0e1e7a;
        color: #0e1e7a;
        transition: all 0.3s ease;
    }
    .btn-outline-brand:hover {
        background-color: #0e1e7a;
        color: #fff;
    }
    .btn-brand {
        background-color: #0e1e7a;
        border: 1px solid #0e1e7a;
        color: #fff;
        transition: all 0.2s ease;
    }
    .btn-brand:hover {
        background-color: #0b1560;
        border-color: #0b1560;
    }

    .lowongan-card,
    .event-card,
    .narsum-card {
        border: 1px solid #d9d9d9 !important;
        box-shadow: 0 2px 8px rgba(95, 95, 95, 0.25) !important;
        transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    }

    .lowongan-card:hover,
    .event-card:hover,
    .narsum-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 8px 24px rgba(0,0,0,0.35) !important;
        cursor: pointer;
    }

</style>
{% endblock %}


{% block content %}
<div class="container my-4">
    <h3 class="mb-4">Hasil pencarian untuk: <em>{{ query }}</em></h3>

    <!-- Category Toggle -->
    <div class="btn-group w-100 mb-4" role="group" aria-label="Kategori Hasil">

        <!-- Lowongan -->
        <a href="{% if category == 'lowongan' %}?q={{ query }}{% else %}?q={{ query }}&category=lowongan{% endif %}"
        class="btn border w-100 {% if category == 'lowongan' %}text-white{% endif %}"
        style="border-color:#0e1e7a; {% if category == 'lowongan' %}background-color:#0e1e7a;{% else %}color:black;{% endif %}">
        Lowongan
        </a>

        <!-- Event -->
        <a href="{% if category == 'event' %}?q={{ query }}{% else %}?q={{ query }}&category=event{% endif %}"
        class="btn border w-100 {% if category == 'event' %}text-white{% endif %}"
        style="border-color:#0e1e7a; {% if category == 'event' %}background-color:#0e1e7a;{% else %}color:black;{% endif %}">
        Event
        </a>

        <!-- Narasumber -->
        <a href="{% if category == 'narasumber' %}?q={{ query }}{% else %}?q={{ query }}&category=narasumber{% endif %}"
        class="btn border w-100 {% if category == 'narasumber' %}text-white{% endif %}"
        style="border-color:#0e1e7a; {% if category == 'narasumber' %}background-color:#0e1e7a;{% else %}color:black;{% endif %}">
        Narasumber
        </a>

        <!-- Pengguna -->
        <a href="{% if category == 'pengguna' %}?q={{ query }}{% else %}?q={{ query }}&category=pengguna{% endif %}"
        class="btn border w-100 {% if category == 'pengguna' %}text-white{% endif %}"
        style="border-color:#0e1e7a; {% if category == 'pengguna' %}background-color:#0e1e7a;{% else %}color:black;{% endif %}">
        Pengguna
        </a>

    </div>


    {% if not category or category == "lowongan" %}
    <!-- Lowongan -->
    <div id="sectionLowongan" class="mb-5">

        {% if category == "lowongan" %}
        <!-- Filter Expertise -->
        <div class="border rounded p-3 mb-4 bg-white shadow-sm">
            <form method="get" class="row g-3 align-items-center">
                <input type="hidden" name="q" value="{{ query }}">
                <input type="hidden" name="category" value="lowongan">

                <!-- Expertise Checkboxes -->
                <div class="col-12 col-md-10">
                    <div class="d-flex flex-wrap gap-3">
                        {% for ex in expertise_categories %}
                        <div class="form-check form-check-inline">
                            <input class="form-check-input"
                                type="checkbox"
                                name="expertise"
                                value="{{ ex.id }}"
                                id="lowongan_ex{{ ex.id }}"
                                {% if ex.id in selected_expertise %}checked{% endif %}
                                style="accent-color:#0e1e7a;">
                            <label class="form-check-label small" for="lowongan_ex{{ ex.id }}">
                                {{ ex.name }} ({{ ex.count }})
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Filter Button -->
                <div class="col-12 col-md-2 text-md-end">
                    <button type="submit" class="btn btn-sm btn-brand text-white px-4">Filter</button>
                </div>
            </form>
        </div>
        {% endif %}

        <h4 class="mb-3">
            {% if category == "lowongan" %}
                Lowongan ({{ lowongans.start_index }}–{{ lowongans.end_index }} dari {{ lowongans.paginator.count }})
            {% else %}
                Lowongan
            {% endif %}
        </h4>
        {% if lowongans %}
            <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
                {% if category == "lowongan" %}
                    {% for l in lowongans %}
                    <div class="col">
                        <a href="{% url 'lowongan:detail' l.id %}" class="text-decoration-none text-dark">
                            <div class="card h-100 border-0 rounded-3 overflow-hidden shadow-sm lowongan-card">
                                {% if l.created_by.event_profile.cover_image %}
                                <img src="{{ l.created_by.event_profile.cover_image.url }}"
                                    class="card-img-top"
                                    alt="{{ l.title }}"
                                    style="width: 100%; height: auto; object-fit: cover;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center" style="width: 100%; aspect-ratio: 4/1;">
                                    <i class="bi bi-calendar-event text-secondary" style="font-size:2rem;"></i>
                                </div>
                                {% endif %}

                                <div class="card-body d-flex flex-column">
                                    <!-- Title -->
                                    <h5 class="card-title mb-1">{{ l.title }}</h5>
                                    <p class="text-muted small mb-2">{{ l.get_job_type_display }}</p>

                                    <!-- Badges -->
                                    <div class="mb-2">
                                        <span class="badge rounded-pill bg-primary me-1 small">{{ l.expertise_category.name }}</span>
                                        {% if l.is_remote %}
                                            <span class="badge rounded-pill bg-success small">Remote</span>
                                        {% endif %}
                                    </div>

                                    <!-- Description -->
                                    <p class="card-text small flex-grow-1">
                                        {{ l.description|truncatewords:20 }}
                                    </p>

                                    <!-- Info list -->
                                    <ul class="list-unstyled small mt-2 mb-0">
                                        <li><i class="bi bi-geo-alt me-1 text-muted"></i> {{ l.location_display }}</li>
                                        <li><i class="bi bi-calendar-event me-1 text-muted"></i> {{ l.event_date|date:"M j, Y" }}</li>
                                        <li><i class="bi bi-hourglass-split me-1 text-muted"></i> {{ l.duration_hours }} jam</li>
                                        {% if l.budget_amount %}
                                        <li>
                                            <i class="bi bi-cash-coin me-1 text-muted"></i> 
                                            IDR {{ l.budget_amount|floatformat:0 }}{% if l.budget_negotiable %} (nego){% endif %}
                                        </li>
                                        {% endif %}
                                        <li>
                                            <i class="bi bi-alarm me-1 text-danger"></i> 
                                            Deadline: {{ l.application_deadline|date:"M j, Y" }}
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                {% else %}
                    {% for l in lowongans|slice:":8" %}
                    <div class="col">
                        <a href="{% url 'lowongan:detail' l.id %}" class="text-decoration-none text-dark">
                            <div class="card h-100 border-0 rounded-3 overflow-hidden shadow-sm lowongan-card">
                                {% if l.created_by.event_profile.cover_image %}
                                <img src="{{ l.created_by.event_profile.cover_image.url }}"
                                    class="card-img-top"
                                    alt="{{ l.title }}"
                                    style="width: 100%; height: auto; object-fit: cover;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center" style="width: 100%; aspect-ratio: 4/1;">
                                    <i class="bi bi-calendar-event text-secondary" style="font-size:2rem;"></i>
                                </div>
                                {% endif %}

                                <div class="card-body d-flex flex-column">
                                    <!-- Title -->
                                    <h5 class="card-title mb-1">{{ l.title }}</h5>
                                    <p class="text-muted small mb-2">{{ l.get_job_type_display }}</p>

                                    <!-- Badges -->
                                    <div class="mb-2">
                                        <span class="badge rounded-pill bg-primary me-1 small">{{ l.expertise_category.name }}</span>
                                        {% if l.is_remote %}
                                            <span class="badge rounded-pill bg-success small">Remote</span>
                                        {% endif %}
                                    </div>

                                    <!-- Description -->
                                    <p class="card-text small flex-grow-1">
                                        {{ l.description|truncatewords:20 }}
                                    </p>

                                    <!-- Info list -->
                                    <ul class="list-unstyled small mt-2 mb-0">
                                        <li><i class="bi bi-geo-alt me-1 text-muted"></i> {{ l.location_display }}</li>
                                        <li><i class="bi bi-calendar-event me-1 text-muted"></i> {{ l.event_date|date:"M j, Y" }}</li>
                                        <li><i class="bi bi-hourglass-split me-1 text-muted"></i> {{ l.duration_hours }} jam</li>
                                        {% if l.budget_amount %}
                                        <li>
                                            <i class="bi bi-cash-coin me-1 text-muted"></i> 
                                            IDR {{ l.budget_amount|floatformat:0 }}{% if l.budget_negotiable %} (nego){% endif %}
                                        </li>
                                        {% endif %}
                                        <li>
                                            <i class="bi bi-alarm me-1 text-danger"></i> 
                                            Deadline: {{ l.application_deadline|date:"M j, Y" }}
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>

            {% if category == "lowongan" %}
                <!-- Pagination -->
                <nav aria-label="Page navigation" class="mt-3">
                    <ul class="pagination justify-content-center">
                        {% if lowongans.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?q={{ query }}&category=lowongan&page={{ lowongans.previous_page_number }}{% for e in selected_expertise %}&expertise={{ e }}{% endfor %}">Previous</a>
                        </li>
                        {% endif %}
                        <li class="page-item disabled"><span class="page-link">Page {{ lowongans.number }} of {{ lowongans.paginator.num_pages }}</span></li>
                        {% if lowongans.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?q={{ query }}&category=lowongan&page={{ lowongans.next_page_number }}{% for e in selected_expertise %}&expertise={{ e }}{% endfor %}">Next</a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
            {% elif has_more.lowongan %}
                <div class="text-center mt-3">
                    <a href="?q={{ query }}&category=lowongan" class="btn btn-outline-brand">More Lowongan</a>
                </div>
            {% endif %}
        {% else %}
            <p class="text-muted">Tidak ada lowongan ditemukan.</p>
        {% endif %}
    </div>
    {% endif %}

    {% if not category or category == "event" %}
    <!-- Event -->
    <div id="sectionEvent" class="mb-5">
        <h4 class="mb-3">
            {% if category == "event" %}
                Event ({{ events.start_index }}–{{ events.end_index }} dari {{ events.paginator.count }})
            {% else %}
                Event
            {% endif %}
        </h4>
        {% if events %}
            <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
                {% if category == "event" %}
                    {% for e in events %}
                    <div class="col">
                        <a href="{% url 'profiles:profile_detail' e.user.username %}" class="text-decoration-none text-dark">
                            <div class="card h-100 border-0 rounded-3 overflow-hidden shadow-sm event-card">
                                {% if e.cover_image %}
                                <img src="{{ e.cover_image.url }}"
                                    class="card-img-top"
                                    alt="{{ e.name }}"
                                    style="width: 100%; height: auto; object-fit: cover;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center" style="width: 100%; aspect-ratio: 4/1;">
                                    <i class="bi bi-calendar-event text-secondary" style="font-size:2rem;"></i>
                                </div>
                                {% endif %}

                                <div class="card-body d-flex flex-column">
                                    <!-- Title -->
                                    <h5 class="card-title mb-1">{{ e.name }}</h5>
                                    <p class="text-muted small mb-2">{{ e.event_status }}</p>

                                    <!-- Badges: lokasi & durasi -->
                                    <div class="mb-2">
                                        <span class="badge rounded-pill bg-primary me-1 small">
                                            <i class="bi bi-geo-alt me-1"></i>{{ e.location_display }}
                                        </span>
                                        <span class="badge rounded-pill bg-secondary small">
                                            <i class="bi bi-calendar3 me-1"></i>{{ e.event_duration_display }}
                                        </span>
                                    </div>

                                    <!-- Description -->
                                    <p class="card-text small flex-grow-1">
                                        {{ e.description|truncatewords:20 }}
                                    </p>

                                    <!-- Extra Info -->
                                    <ul class="list-unstyled small mt-2 mb-0">
                                        {% if e.website %}
                                        <li><i class="bi bi-globe me-1 text-muted"></i> Website tersedia</li>
                                        {% endif %}
                                        {% if e.linkedin_url %}
                                        <li><i class="bi bi-linkedin me-1 text-muted"></i> LinkedIn tersedia</li>
                                        {% endif %}
                                        {% if e.get_public_phone %}
                                        <li><i class="bi bi-telephone me-1 text-muted"></i> {{ e.get_public_phone }}</li>
                                        {% endif %}
                                        <li><i class="bi bi-envelope me-1 text-muted"></i> {{ e.email }}</li>
                                    </ul>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                {% else %}
                    {% for e in events|slice:":8" %}
                    <div class="col">
                        <a href="{% url 'profiles:profile_detail' e.user.username %}" class="text-decoration-none text-dark">
                            <div class="card h-100 border-0 rounded-3 overflow-hidden shadow-sm event-card">
                                {% if e.cover_image %}
                                <img src="{{ e.cover_image.url }}"
                                    class="card-img-top"
                                    alt="{{ e.name }}"
                                    style="width: 100%; height: auto; object-fit: cover;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center" style="width: 100%; aspect-ratio: 4/1;">
                                    <i class="bi bi-calendar-event text-secondary" style="font-size:2rem;"></i>
                                </div>
                                {% endif %}

                                <div class="card-body d-flex flex-column">
                                    <!-- Title -->
                                    <h5 class="card-title mb-1">{{ e.name }}</h5>
                                    <p class="text-muted small mb-2">{{ e.event_status }}</p>

                                    <!-- Badges: lokasi & durasi -->
                                    <div class="mb-2">
                                        <span class="badge rounded-pill bg-primary me-1 small">
                                            <i class="bi bi-geo-alt me-1"></i>{{ e.location_display }}
                                        </span>
                                        <span class="badge rounded-pill bg-info small">
                                            <i class="bi bi-calendar3 me-1"></i>{{ e.event_duration_display }}
                                        </span>
                                    </div>

                                    <!-- Description -->
                                    <p class="card-text small flex-grow-1">
                                        {{ e.description|truncatewords:20 }}
                                    </p>

                                    <!-- Extra Info -->
                                    <ul class="list-unstyled small mt-2 mb-0">
                                        {% if e.website %}
                                        <li><i class="bi bi-globe me-1 text-muted"></i> Website tersedia</li>
                                        {% endif %}
                                        {% if e.linkedin_url %}
                                        <li><i class="bi bi-linkedin me-1 text-muted"></i> LinkedIn tersedia</li>
                                        {% endif %}
                                        {% if e.get_public_phone %}
                                        <li><i class="bi bi-telephone me-1 text-muted"></i> {{ e.get_public_phone }}</li>
                                        {% endif %}
                                        <li><i class="bi bi-envelope me-1 text-muted"></i> {{ e.email }}</li>
                                    </ul>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>

            {% if category == "event" %}
                <!-- Pagination -->
                <nav aria-label="Page navigation" class="mt-3">
                    <ul class="pagination justify-content-center">
                        {% if events.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?q={{ query }}&category=event&page={{ events.previous_page_number }}">Previous</a>
                        </li>
                        {% endif %}
                        <li class="page-item disabled"><span class="page-link">Page {{ events.number }} of {{ events.paginator.num_pages }}</span></li>
                        {% if events.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?q={{ query }}&category=event&page={{ events.next_page_number }}">Next</a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
            {% elif has_more.event %}
                <div class="text-center mt-3">
                    <a href="?q={{ query }}&category=event" class="btn btn-outline-brand">More Event</a>
                </div>
            {% endif %}
        {% else %}
            <p class="text-muted">Tidak ada event ditemukan.</p>
        {% endif %}
    </div>
    {% endif %}

    {% if not category or category == "narasumber" %}
    <!-- Narasumber -->
    <div id="sectionNarasumber">

        {% if category == "narasumber" %}
        <!-- Filter Expertise -->
        <div class="border rounded p-3 mb-4 bg-white shadow-sm">
            <form method="get" class="row g-3 align-items-center">
                <input type="hidden" name="q" value="{{ query }}">
                <input type="hidden" name="category" value="narasumber">

                <!-- Expertise Checkboxes -->
                <div class="col-12 col-md-10">
                    <div class="d-flex flex-wrap gap-3">
                        {% for ex in expertise_categories %}
                        <div class="form-check form-check-inline">
                            <input class="form-check-input"
                                type="checkbox"
                                name="expertise"
                                value="{{ ex.id }}"
                                id="ex{{ ex.id }}"
                                {% if ex.id in selected_expertise %}checked{% endif %}
                                style="accent-color:#0e1e7a;">
                            <label class="form-check-label small" for="ex{{ ex.id }}">
                                {{ ex.name }} ({{ ex.count }})
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Filter Button -->
                <div class="col-12 col-md-2 text-md-end">
                    <button type="submit" class="btn btn-sm btn-brand text-white px-4">Filter</button>
                </div>
            </form>
        </div>
        {% endif %}


        <h4 class="mb-3">
            {% if category == "narasumber" %}
                Narasumber ({{ narasumbers.start_index }}–{{ narasumbers.end_index }} dari {{ narasumbers.paginator.count }})
            {% else %}
                Narasumber
            {% endif %}
        </h4>


        {% if narasumbers %}
            <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
                {% if category == "narasumber" %}
                    {% for n in narasumbers %}
                    <div class="col">
                        <a href="{% url 'profiles:profile_detail' n.user.username %}" class="text-decoration-none text-dark">
                            <div class="card h-100 border-0 rounded-3 overflow-hidden shadow-sm narsum-card">
                                {% if n.profile_picture %}
                                <img src="{{ n.profile_picture.url }}" 
                                    class="card-img-top" 
                                    alt="{{ n.full_name }}" 
                                    style="object-fit: cover; height: 180px;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center" style="height:180px;">
                                    <i class="bi bi-person-circle text-secondary" style="font-size:3rem;"></i>
                                </div>
                                {% endif %}

                                <div class="card-body d-flex flex-column">
                                    <!-- Nama -->
                                    <h5 class="card-title mb-1">{{ n.full_name }}</h5>
                                    <p class="text-muted small mb-2">{{ n.experience_display }}</p>

                                    <!-- Expertise Badge -->
                                    <div class="mb-2">
                                        <span class="badge rounded-pill bg-primary small">
                                            {{ n.expertise_area.name }}
                                        </span>
                                    </div>

                                    <!-- Bio -->
                                    <p class="card-text small flex-grow-1">
                                        {{ n.bio|truncatewords:18 }}
                                    </p>

                                    <!-- Lokasi -->
                                    <p class="small mb-1">
                                        <i class="bi bi-geo-alt me-1 text-muted"></i> {{ n.location_display }}
                                    </p>

                                    <!-- Kontak (opsional) -->
                                    <ul class="list-unstyled small mb-0">
                                        <li><i class="bi bi-envelope me-1 text-muted"></i> {{ n.email }}</li>
                                        {% if n.get_public_phone %}
                                        <li><i class="bi bi-telephone me-1 text-muted"></i> {{ n.get_public_phone }}</li>
                                        {% endif %}
                                        {% if n.linkedin_url %}
                                        <li><i class="bi bi-linkedin me-1 text-muted"></i> LinkedIn tersedia</li>
                                        {% endif %}
                                        {% if n.portfolio_link %}
                                        <li><i class="bi bi-globe me-1 text-muted"></i> Portfolio tersedia</li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                {% else %}
                    {% for n in narasumbers|slice:":8" %}
                    <div class="col">
                        <a href="{% url 'profiles:profile_detail' n.user.username %}" class="text-decoration-none text-dark">
                            <div class="card h-100 border-0 rounded-3 overflow-hidden shadow-sm narsum-card">
                                {% if n.profile_picture %}
                                <img src="{{ n.profile_picture.url }}" 
                                    class="card-img-top" 
                                    alt="{{ n.full_name }}" 
                                    style="object-fit: cover; height: 180px;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center" style="height:180px;">
                                    <i class="bi bi-person-circle text-secondary" style="font-size:3rem;"></i>
                                </div>
                                {% endif %}

                                <div class="card-body d-flex flex-column">
                                    <!-- Nama -->
                                    <h5 class="card-title mb-1">{{ n.full_name }}</h5>
                                    <p class="text-muted small mb-2">{{ n.experience_display }}</p>

                                    <!-- Expertise Badge -->
                                    <div class="mb-2">
                                        <span class="badge rounded-pill bg-primary small">
                                            {{ n.expertise_area.name }}
                                        </span>
                                    </div>

                                    <!-- Bio -->
                                    <p class="card-text small flex-grow-1">
                                        {{ n.bio|truncatewords:18 }}
                                    </p>

                                    <!-- Lokasi -->
                                    <p class="small mb-1">
                                        <i class="bi bi-geo-alt me-1 text-muted"></i> {{ n.location_display }}
                                    </p>

                                    <!-- Kontak (opsional) -->
                                    <ul class="list-unstyled small mb-0">
                                        <li><i class="bi bi-envelope me-1 text-muted"></i> {{ n.email }}</li>
                                        {% if n.get_public_phone %}
                                        <li><i class="bi bi-telephone me-1 text-muted"></i> {{ n.get_public_phone }}</li>
                                        {% endif %}
                                        {% if n.linkedin_url %}
                                        <li><i class="bi bi-linkedin me-1 text-muted"></i> LinkedIn tersedia</li>
                                        {% endif %}
                                        {% if n.portfolio_link %}
                                        <li><i class="bi bi-globe me-1 text-muted"></i> Portfolio tersedia</li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>

            {% if category == "narasumber" %}
            <!-- Pagination -->
            <nav aria-label="Page navigation" class="mt-3">
                <ul class="pagination justify-content-center">
                    {% if narasumbers.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?q={{ query }}&category=narasumber&page={{ narasumbers.previous_page_number }}{% for e in selected_expertise %}&expertise={{ e }}{% endfor %}">Previous</a>
                    </li>
                    {% endif %}
                    <li class="page-item disabled"><span class="page-link">Page {{ narasumbers.number }} of {{ narasumbers.paginator.num_pages }}</span></li>
                    {% if narasumbers.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?q={{ query }}&category=narasumber&page={{ narasumbers.next_page_number }}{% for e in selected_expertise %}&expertise={{ e }}{% endfor %}">Next</a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% elif has_more.narasumber %}
                <div class="text-center mt-3">
                    <a href="?q={{ query }}&category=narasumber" class="btn btn-outline-brand">More Narasumber</a>
                </div>
            {% endif %}
        {% else %}
            <p class="text-muted">Tidak ada narasumber ditemukan.</p>
        {% endif %}
    </div>
    {% endif %}

    {% if not category or category == "pengguna" %}
    <!-- Pengguna -->
    <div id="sectionPengguna" class="mt-5">

        <h4 class="mb-3">
            {% if category == "pengguna" %}
                Pengguna ({{ penggunas.start_index }}–{{ penggunas.end_index }} dari {{ penggunas.paginator.count }})
            {% else %}
                Pengguna
            {% endif %}
        </h4>

        {% if penggunas %}
            <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
                {% if category == "pengguna" %}
                    {% for p in penggunas %}
                    <div class="col">
                        <a href="#" class="text-decoration-none text-dark">
                            <div class="card h-100 border-0 rounded-3 overflow-hidden shadow-sm narsum-card">
                                {% if p.profile_picture %}
                                <img src="{{ p.profile_picture.url }}" 
                                    class="card-img-top" 
                                    alt="{{ p.full_name }}" 
                                    style="object-fit: cover; height: 180px;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center" style="height:180px;">
                                    <i class="bi bi-person-circle text-secondary" style="font-size:3rem;"></i>
                                </div>
                                {% endif %}

                                <div class="card-body d-flex flex-column">
                                    <!-- Nama -->
                                    <h5 class="card-title mb-1">{{ p.full_name }}</h5>
                                    <p class="text-muted small mb-2">Pengguna Terdaftar</p>

                                    <!-- Bio -->
                                    <p class="card-text small flex-grow-1">
                                        {{ p.bio|truncatewords:18 }}
                                    </p>

                                    <!-- Lokasi -->
                                    <p class="small mb-1">
                                        <i class="bi bi-geo-alt me-1 text-muted"></i> {{ p.location_display }}
                                    </p>

                                    <!-- Kontak -->
                                    <ul class="list-unstyled small mb-0">
                                        <li><i class="bi bi-envelope me-1 text-muted"></i> {{ p.email }}</li>
                                        {% if p.get_public_phone %}
                                        <li><i class="bi bi-telephone me-1 text-muted"></i> {{ p.get_public_phone }}</li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                {% else %}
                    {% for p in penggunas|slice:":8" %}
                    <div class="col">
                        <a href="#" class="text-decoration-none text-dark">
                            <div class="card h-100 border-0 rounded-3 overflow-hidden shadow-sm narsum-card">
                                {% if p.profile_picture %}
                                <img src="{{ p.profile_picture.url }}" 
                                    class="card-img-top" 
                                    alt="{{ p.full_name }}" 
                                    style="object-fit: cover; height: 180px;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center" style="height:180px;">
                                    <i class="bi bi-person-circle text-secondary" style="font-size:3rem;"></i>
                                </div>
                                {% endif %}

                                <div class="card-body d-flex flex-column">
                                    <!-- Nama -->
                                    <h5 class="card-title mb-1">{{ p.full_name }}</h5>
                                    <p class="text-muted small mb-2">Pengguna Terdaftar</p>

                                    <!-- Bio -->
                                    <p class="card-text small flex-grow-1">
                                        {{ p.bio|truncatewords:18 }}
                                    </p>

                                    <!-- Lokasi -->
                                    <p class="small mb-1">
                                        <i class="bi bi-geo-alt me-1 text-muted"></i> {{ p.location_display }}
                                    </p>

                                    <!-- Kontak -->
                                    <ul class="list-unstyled small mb-0">
                                        <li><i class="bi bi-envelope me-1 text-muted"></i> {{ p.email }}</li>
                                        {% if p.get_public_phone %}
                                        <li><i class="bi bi-telephone me-1 text-muted"></i> {{ p.get_public_phone }}</li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>

            {% if category == "pengguna" %}
            <!-- Pagination -->
            <nav aria-label="Page navigation" class="mt-3">
                <ul class="pagination justify-content-center">
                    {% if penggunas.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?q={{ query }}&category=pengguna&page={{ penggunas.previous_page_number }}">Previous</a>
                    </li>
                    {% endif %}
                    <li class="page-item disabled">
                        <span class="page-link">Page {{ penggunas.number }} of {{ penggunas.paginator.num_pages }}</span>
                    </li>
                    {% if penggunas.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?q={{ query }}&category=pengguna&page={{ penggunas.next_page_number }}">Next</a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% elif has_more.pengguna %}
                <div class="text-center mt-3">
                    <a href="?q={{ query }}&category=pengguna" class="btn btn-outline-brand">More Pengguna</a>
                </div>
            {% endif %}
        {% else %}
            <p class="text-muted">Tidak ada pengguna ditemukan.</p>
        {% endif %}
    </div>
    {% endif %}

</div>
{% endblock %}
