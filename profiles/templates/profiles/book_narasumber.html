{% extends 'base.html' %}

{% block title %}Book a Narasumber - NarraPro{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'profiles:profile_booking' username=request.user.username %}">Booking</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Cari Narasumber</li>
                </ol>
            </nav>
            <h2 class="mb-4">Cari Narasumber</h2>
            <p class="text-muted">Temukan narasumber yang tepat untuk event Anda.</p>
        </div>
    </div>

    <!-- Search and Filter -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get">
                <div class="row g-3">
                    <div class="col-md-8">
                        <input type="text" name="q" class="form-control" placeholder="Cari berdasarkan nama atau keahlian..." value="{{ request.GET.q }}">
                    </div>
                    <div class="col-md-4">
                        <select name="category" class="form-select">
                            <option value="">Semua Kategori</option>
                            {% for category in categories %}
                                <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>{{ category.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="mt-3 text-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search me-2"></i>Cari
                    </button>
                    <a href="{% url 'profiles:book_narasumber' username=request.user.username %}" class="btn btn-secondary">
                        <i class="fas fa-sync-alt me-2"></i>Reset
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Narasumber List -->
    <div class="row">
        {% if narasumber_list %}
            {% for narasumber_user in narasumber_list %}
                <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
                    <div class="card h-100">
                        <div class="card-body text-center d-flex flex-column">
                            <a href="{% url 'profiles:profile_detail' narasumber_user.username %}">
                                {% if narasumber_user.narasumber_profile.profile_picture %}
                                    <img src="{{ narasumber_user.narasumber_profile.profile_picture.url }}"
                                         alt="{{ narasumber_user.get_full_name }}" 
                                         class="rounded-circle mb-3 mx-auto d-block" 
                                         width="100" 
                                         height="100"
                                         style="object-fit: cover;">
                                {% else %}
                                    <div class="bg-light rounded-circle d-flex align-items-center justify-content-center mb-3 mx-auto"
                                         style="width: 100px; height: 100px; border: 1px solid #dee2e6;">
                                        <i class="fas fa-user fa-2x text-muted"></i>
                                    </div>
                                {% endif %}
                            </a>
                            <h5 class="card-title">
                                <a href="{% url 'profiles:profile_detail' narasumber_user.username %}" class="text-decoration-none text-dark">
                                    {{ narasumber_user.get_full_name }}
                                </a>
                            </h5>
                            <p class="card-text text-muted">
                                {% if narasumber_user.narasumber_profile.expertise_area %}
                                    <span class="badge bg-light text-dark">{{ narasumber_user.narasumber_profile.expertise_area.name }}</span>
                                {% else %}
                                    <span class="text-muted small">Belum ada keahlian</span>
                                {% endif %}
                            </p>
                            <p class="card-text small text-muted flex-grow-1">{{ narasumber_user.narasumber_profile.bio|truncatewords:15 }}</p>
                            <a href="{% url 'profiles:create_booking' username=request.user.username narasumber_id=narasumber_user.id %}" class="btn btn-primary btn-sm mt-auto">
                                <i class="fas fa-calendar-plus me-2"></i>Book Now
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="col-12">
                <div class="text-center py-5">
                    <i class="fas fa-users-slash fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">Narasumber tidak ditemukan</h5>
                    <p class="text-muted">Coba ubah kriteria pencarian Anda.</p>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
